# üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CDN –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —Ä–µ–∫–ª–∞–º—ã

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–ù–∞—Å—Ç—Ä–æ–∏–ª –æ–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤ —Ä–µ–∫–ª–∞–º—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
- **–Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞**: –∑–∞–º–µ–Ω–∏–ª `mc.yandex.ru` –Ω–∞ `mc.webvisor.org`
- **VK Pixel**: –Ω–∞—Å—Ç—Ä–æ–∏–ª –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `/vk-pixel/`

### üìÅ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

#### 1. **PixelManager** (`src/components/PixelManager/index.tsx`)
- ‚úÖ –ó–∞–º–µ–Ω–∏–ª `https://mc.yandex.ru/metrika/tag.js` ‚Üí `https://mc.webvisor.org/metrika/tag_ww.js`
- ‚úÖ –û–±–Ω–æ–≤–∏–ª noscript img: `https://mc.yandex.ru/watch/` ‚Üí `https://mc.webvisor.org/watch/`

#### 2. **Middleware** (`src/middleware.ts`)
- ‚úÖ –û–±–Ω–æ–≤–∏–ª –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ: `/metrika/tag.js` ‚Üí `https://mc.webvisor.org/metrika/tag_ww.js`
- ‚úÖ –û–±–Ω–æ–≤–∏–ª –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ: `/metrika/watch` ‚Üí `https://mc.webvisor.org/watch`

#### 3. **API —Ç–µ—Å—Ç** (`src/app/api/test/metrika/route.ts`)
- ‚úÖ –ó–∞–º–µ–Ω–∏–ª URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–∞ `https://mc.webvisor.org/metrika/tag_ww.js`

#### 4. **Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`next.config.mjs`)
- ‚úÖ –î–æ–±–∞–≤–∏–ª `mc.webvisor.org` –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –û–±–Ω–æ–≤–∏–ª Content Security Policy –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤–æ–≥–æ CDN
- ‚úÖ –û–±–Ω–æ–≤–∏–ª rewrites –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –Ω–æ–≤—ã–π CDN

#### 5. **Debug –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** (`src/components/YandexMetrika/YandexMetrikaDebug.tsx`)
- ‚úÖ –î–æ–±–∞–≤–∏–ª –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∫—Ä–∏–ø—Ç–æ–≤ —Å `mc.webvisor.org`

#### 6. **Backup —Ñ–∞–π–ª—ã**
- ‚úÖ `src/app/(frontend)/[lang]/layout.backup.tsx`
- ‚úÖ `src/app/(frontend)/[lang]/layout.old.tsx`

#### 7. **–¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** (`src/components/YandexMetrikaTest.tsx`)
- ‚úÖ –û–±–Ω–æ–≤–∏–ª –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

#### 8. **VK Pixel –æ–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**
- ‚úÖ –û–±–Ω–æ–≤–∏–ª `src/components/PixelManager/index.tsx` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `/vk-pixel/` –ø—Ä–æ–∫—Å–∏
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏–ª middleware –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è VK –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –î–æ–±–∞–≤–∏–ª VK –¥–æ–º–µ–Ω—ã –≤ Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚úÖ –°–æ–∑–¥–∞–ª API —Ç–µ—Å—Ç –¥–ª—è VK Pixel (`/api/test/vk-pixel`)
- ‚úÖ –°–æ–∑–¥–∞–ª –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è VK Pixel

#### 9. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (`docs/legacy/FINAL_IMPLEMENTATION_GUIDE.md`)
- ‚úÖ –û–±–Ω–æ–≤–∏–ª –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ CDN

### ‚úÖ **–Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞ (mc.webvisor.org)**
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –¥–æ–º–µ–Ω –Ø–Ω–¥–µ–∫—Å–∞
- –û–±—Ö–æ–¥–∏—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤ —Ä–µ–∫–ª–∞–º—ã
- –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º API
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### ‚úÖ **VK Pixel (–ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ)**
- –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω `/vk-pixel/`
- –û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤ —Ä–µ–∫–ª–∞–º—ã
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π VK Retargeting
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

### üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `tag_ww.js` –≤–º–µ—Å—Ç–æ `tag.js` (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

## üöÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:**
   ```bash
   npm run dev
   ```

2. **–û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network:**
   - –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø—Ä–æ—Å—ã –∫ `mc.webvisor.org` (–Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞)
   - –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø—Ä–æ—Å—ã –∫ `/vk-pixel/` (VK Pixel)
   - –°–∫—Ä–∏–ø—Ç `tag_ww.js` –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å:**
   - –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∏
   - –§—É–Ω–∫—Ü–∏—è `ym()` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞
   - –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ VK Pixel
   - –û–±—ä–µ–∫—Ç `VK.Retargeting` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω

4. **–¢–µ—Å—Ç–æ–≤—ã–µ API:**
   - `/api/test/metrika` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∏
   - `/api/test/vk-pixel` - –ø—Ä–æ–≤–µ—Ä–∫–∞ VK Pixel

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç –ø–æ—Å—Ç—É–ø–∞—Ç—å –≤ —Ç–æ—Ç –∂–µ —Å—á–µ—Ç—á–∏–∫ –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∏
- –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å—á–µ—Ç—á–∏–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–∞–∫ –æ–±—ã—á–Ω–æ

## üîÑ –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)

–î–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É CDN –∑–∞–º–µ–Ω–∏—Ç–µ –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö:
- `mc.webvisor.org/metrika/tag_ww.js` ‚Üí `mc.yandex.ru/metrika/tag.js`
- `mc.webvisor.org/watch` ‚Üí `mc.yandex.ru/watch`

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** $(date)  
**–í–µ—Ä—Å–∏—è:** 1.0
