# üöÄ –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π

## üìã –ü—Ä–æ–±–ª–µ–º—ã, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –Ω–∞ https://flow-masters.ru/en/test/analytics

### ‚ùå **–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
2. **DNS/Network –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**
3. **–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã**
4. **Proxy endpoints –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç**

---

## üîß **–ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (5 –º–∏–Ω—É—Ç)**

### **–®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# Analytics Configuration
NEXT_PUBLIC_YANDEX_METRIKA_ID=101007010
NEXT_PUBLIC_VK_PIXEL_ID=VK-RTRG-2138516-bKJJr
NEXT_PUBLIC_GOOGLE_ANALYTICS_ID=G-XXXXXXXXXX

# Force load all pixels (for testing)
NEXT_PUBLIC_FORCE_LOAD_PIXELS=true
```

### **–®–∞–≥ 2: –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º**

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   ```
   https://flow-masters.ru/en/test/analytics
   ```

2. **–ù–∞–∂–º–∏—Ç–µ –∫—Ä–∞—Å–Ω—É—é –∫–Ω–æ–ø–∫—É:**
   ```
   üöÄ –ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨ –í–°–ï –ü–ò–ö–°–ï–õ–ò
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** (–µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ):
   ```bash
   npm run dev
   # –∏–ª–∏
   yarn dev
   ```

### **–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- ‚úÖ **Force Mode: –ê–ö–¢–ò–í–ï–ù**
- ‚úÖ **–í—Å–µ –ø–∏–∫—Å–µ–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã**
- ‚úÖ **–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã**
- ‚úÖ **Proxy endpoints —Ä–∞–±–æ—Ç–∞—é—Ç**

---

## üìä **–î–µ—Ç–∞–ª—å–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

### **1. –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
‚ùå NEXT_PUBLIC_VK_PIXEL_ID not set
‚ùå Missing analytics IDs for: vkPixel, googleAnalytics
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ .env.local
NEXT_PUBLIC_VK_PIXEL_ID=VK-RTRG-2138516-bKJJr
NEXT_PUBLIC_GOOGLE_ANALYTICS_ID=G-XXXXXXXXXX
```

### **2. DNS/Network –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
‚ùå mc.yandex.ru - –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
‚ùå mc.webvisor.org - –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω  
‚ùå vk.com - –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
‚ùå www.googletagmanager.com - –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
```

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞–Ω—ã API proxy –º–∞—Ä—à—Ä—É—Ç—ã:
- `/metrika/[...path]` ‚Üí `https://mc.webvisor.org/`
- `/vk-pixel/[...path]` ‚Üí `https://vk.com/`
- `/vk-ads/[...path]` ‚Üí `https://ads.vk.com/`

### **3. –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
‚ùå Yandex Metrika not loaded
‚ùå VK Pixel not loaded
‚ùå window.ym = undefined
‚ùå window.VK = undefined
```

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –∑–∞–≥—Ä—É–∑–∫–∏:
```bash
NEXT_PUBLIC_FORCE_LOAD_PIXELS=true
```

### **4. Proxy endpoints –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
‚ùå Proxy error: fetch failed
‚ùå localhost:3000/metrika/tag_ww.js - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚ùå localhost:3000/vk-pixel/js/api/openapi.js - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ API –º–∞—Ä—à—Ä—É—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –∏ CORS.

---

## üéØ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**

### **1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
console.log('Yandex ID:', process.env.NEXT_PUBLIC_YANDEX_METRIKA_ID)
console.log('VK ID:', process.env.NEXT_PUBLIC_VK_PIXEL_ID)
console.log('Force Mode:', process.env.NEXT_PUBLIC_FORCE_LOAD_PIXELS)
```

### **2. –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã:**
```javascript
// –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã:
console.log('Yandex Metrika:', typeof window.ym)     // 'function'
console.log('VK Pixel:', typeof window.VK)          // 'object'
console.log('Google Analytics:', typeof window.gtag) // 'function'
```

### **3. Proxy endpoints:**
```bash
# –î–æ–ª–∂–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 200:
curl https://flow-masters.ru/metrika/tag_ww.js
curl https://flow-masters.ru/vk-pixel/js/api/openapi.js
curl https://flow-masters.ru/vk-ads/
```

### **4. Force Mode —Å—Ç–∞—Ç—É—Å:**
```
üöÄ FORCE MODE: –ê–ö–¢–ò–í–ï–ù
‚úÖ –í—Å–µ –ø–∏–∫—Å–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
```

---

## üö® **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è**

### **1. –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞:**
```
Ctrl+Shift+R (Windows/Linux)
Cmd+Shift+R (Mac)
```

### **2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏:**
```
F12 ‚Üí Console ‚Üí –ò—Å–∫–∞—Ç—å –∫—Ä–∞—Å–Ω—ã–µ –æ—à–∏–±–∫–∏
```

### **3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network Tab:**
```
F12 ‚Üí Network ‚Üí –§–∏–ª—å—Ç—Ä: JS ‚Üí –ò—Å–∫–∞—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
```

### **4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:**
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (Ctrl+C) –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ:
npm run dev
```

### **5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
# –ò—Å–∫–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
[Metrika Proxy] Success: ...
[VK Pixel Proxy] Success: ...
üöÄ FORCE MODE: Loading pixel ...
```

---

## ‚úÖ **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**

### **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:**
- üìä **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 25** ‚Üí **–ü—Ä–æ–π–¥–µ–Ω–æ: 20+**
- üìä **–û—à–∏–±–æ–∫: 7** ‚Üí **–û—à–∏–±–æ–∫: 0-2**
- üìä **–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π: 2** ‚Üí **–í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã**
- üìä **Force Mode: ‚ùå –ù–ï –ê–ö–¢–ò–í–ï–ù** ‚Üí **‚úÖ –ê–ö–¢–ò–í–ï–ù**

### **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:**
- ‚úÖ **Yandex Metrika: Loaded**
- ‚úÖ **VK Pixel: Loaded**
- ‚úÖ **DNS Resolution: Accessible**
- ‚úÖ **Proxy endpoints: Working**

### **–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:**
```
üöÄ FORCE MODE: Loading pixel Yandex Metrika (yandex_metrica) regardless of settings
üöÄ FORCE MODE: Loading pixel VK Pixel (vk) regardless of settings
[Metrika Proxy] Success: https://mc.webvisor.org/metrika/tag_ww.js
[VK Pixel Proxy] Success: https://vk.com/js/api/openapi.js
```

---

## üéâ **–ì–æ—Ç–æ–≤–æ!**

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤:
1. ‚úÖ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
2. ‚úÖ Force Mode –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
3. ‚úÖ Proxy endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
4. ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
5. ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

**–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π!** üöÄ
