# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏. –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

## üéØ –°–ø–æ—Å–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. –ß–µ—Ä–µ–∑ CMS (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) 

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∫–∏
- –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∏–∫—Å–µ–ª–µ–π VK
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

1. –î–æ–±–∞–≤—å—Ç–µ –≥–ª–æ–±–∞–ª –≤ payload.config.ts:
```ts
import { AnalyticsSettings } from '@/globals/AnalyticsSettings'

export default buildConfig({
  globals: [
    AnalyticsSettings,
    // ... –¥—Ä—É–≥–∏–µ –≥–ª–æ–±–∞–ª—ã
  ],
})
```

2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ layout.tsx:
```tsx
import { FlexibleAnalyticsProvider } from '@/providers/FlexibleAnalyticsProvider'

export default function Layout({ children }) {
  return (
    <FlexibleAnalyticsProvider configSource="cms">
      {children}
    </FlexibleAnalyticsProvider>
  )
}
```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ –∞–¥–º–∏–Ω–∫–µ:
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É CMS ‚Üí Globals ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –í–∫–ª—é—á–∏—Ç–µ –Ω—É–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- –í–≤–µ–¥–∏—Ç–µ ID —Å—á–µ—Ç—á–∏–∫–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### 2. –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (ID –Ω–µ –≤ –∫–æ–¥–µ)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

1. –î–æ–±–∞–≤—å—Ç–µ –≤ .env.local:
```env
NEXT_PUBLIC_YANDEX_METRIKA_ID=98849829
NEXT_PUBLIC_VK_PIXEL_ID=VK-RTRG-000000-XXXXX
NEXT_PUBLIC_TOP_MAIL_RU_ID=3661858
```

2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ layout.tsx:
```tsx
import { EnvAnalyticsProvider } from '@/providers/FlexibleAnalyticsProvider'

export default function Layout({ children }) {
  return (
    <EnvAnalyticsProvider>
      {children}
    </EnvAnalyticsProvider>
  )
}
```

### 3. –†—É—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- –ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```tsx
import { ManualAnalyticsProvider, AnalyticsConfig } from '@/providers/FlexibleAnalyticsProvider'

const analyticsConfig: AnalyticsConfig = {
  enabled: true,
  debug: process.env.NODE_ENV === 'development',
  yandexMetrica: {
    counterId: '98849829',
    enabled: true,
    options: {
      clickmap: true,
      trackLinks: true,
      webvisor: true, // –í–∫–ª—é—á–∞–µ–º –≤–µ–±–≤–∏–∑–æ—Ä
      accurateTrackBounce: true
    }
  },
  vkPixel: [
    {
      pixelId: 'VK-RTRG-000000-XXXXX',
      enabled: true,
      trackPageView: true
    },
    {
      pixelId: 'VK-RTRG-111111-YYYYY', // –í—Ç–æ—Ä–æ–π –ø–∏–∫—Å–µ–ª—å
      enabled: true,
      trackPageView: false
    }
  ],
  topMailRu: {
    counterId: '3661858',
    enabled: true,
    trackPageView: true
  }
}

export default function Layout({ children }) {
  return (
    <ManualAnalyticsProvider config={analyticsConfig}>
      {children}
    </ManualAnalyticsProvider>
  )
}
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
```tsx
import { useAnalytics } from '@/lib/analytics'

function MyComponent() {
  const analytics = useAnalytics()
  
  const handleClick = () => {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤–æ –≤—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
    analytics.trackEvent('button_click', { 
      button: 'cta',
      location: 'hero' 
    })
    
    analytics.trackGoal('conversion', { 
      source: 'homepage' 
    })
  }
  
  return <button onClick={handleClick}>–ö–ª–∏–∫–Ω–∏ –º–µ–Ω—è</button>
}
```

### –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
```tsx
import { useYandexMetrica, useVKPixel, useTopMailRu } from '@/lib/analytics'

function AdvancedComponent() {
  const ym = useYandexMetrica()
  const vk = useVKPixel()
  const tmr = useTopMailRu()
  
  const handleYandexGoal = () => {
    ym.goal('yandex_specific_goal', { custom_param: 'value' })
  }
  
  const handleVKEvent = () => {
    vk.event('vk_custom_event', { event_value: 100 })
  }
  
  const handleTopMailRuGoal = () => {
    tmr.goal('tmr_conversion', { conversion_type: 'lead' })
  }
  
  return (
    <div>
      <button onClick={handleYandexGoal}>Yandex Goal</button>
      <button onClick={handleVKEvent}>VK Event</button>
      <button onClick={handleTopMailRuGoal}>TMR Goal</button>
    </div>
  )
}
```

### Ecommerce –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
```tsx
import { useEcommerceTracking } from '@/lib/analytics'

function ShopComponent() {
  const { trackPurchase, trackAddToCart } = useEcommerceTracking()
  
  const handlePurchase = () => {
    trackPurchase([
      {
        id: 'product-123',
        name: '–¢–æ–≤–∞—Ä',
        category: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è',
        price: 1000,
        quantity: 1
      }
    ], 'order-' + Date.now(), 1000)
  }
  
  const handleAddToCart = () => {
    trackAddToCart([
      {
        id: 'product-456',
        name: '–î—Ä—É–≥–æ–π —Ç–æ–≤–∞—Ä',
        price: 500,
        quantity: 2
      }
    ])
  }
  
  return (
    <div>
      <button onClick={handleAddToCart}>–í –∫–æ—Ä–∑–∏–Ω—É</button>
      <button onClick={handlePurchase}>–ö—É–ø–∏—Ç—å</button>
    </div>
  )
}
```

## üéõÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ CMS

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **–í–∫–ª—é—á–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É** - –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ
- **–†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç debug –ø–∞–Ω–µ–ª—å –≤ development
- **–î–æ–º–µ–Ω—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è** - –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏
- **–ò—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø—É—Ç–∏** - –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

### Yandex Metrica
- **ID —Å—á–µ—Ç—á–∏–∫–∞** - –Ω–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –Ω–∞ metrica.yandex.ru
- **–ö–∞—Ä—Ç–∞ –∫–ª–∏–∫–æ–≤** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö —Å—Å—ã–ª–æ–∫
- **–í–µ–±–≤–∏–∑–æ—Ä** - –∑–∞–ø–∏—Å—å –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å)
- **–¢–æ—á–Ω—ã–π –æ—Ç–∫–∞–∑** - –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è –æ—Ç–∫–∞–∑–æ–≤

### VK Pixel
- **ID –ø–∏–∫—Å–µ–ª–µ–π** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ (—Ñ–æ—Ä–º–∞—Ç: VK-RTRG-XXXXXX-XXXXX)
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ

### Top.Mail.Ru (VK Ads)
- **ID —Å—á–µ—Ç—á–∏–∫–∞** - –Ω–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –Ω–∞ top.mail.ru
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ

## üîç –û—Ç–ª–∞–¥–∫–∞

### Debug –ø–∞–Ω–µ–ª—å
–í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–∞–Ω–µ–ª—å –æ—Ç–ª–∞–¥–∫–∏:
- –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤ (–∑–∞–≥—Ä—É–∂–µ–Ω—ã/–Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã)
- –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –õ–æ–≥ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—á–∏—Å—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π

### –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º debug —Ä–µ–∂–∏–º–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:
- –°—Ç–∞—Ç—É—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CMS –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
2. –û—Ç–∫–ª—é—á–∏—Ç–µ debug —Ä–µ–∂–∏–º
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø—É—Ç–∏ (/admin, /api)
4. –í–∫–ª—é—á–∏—Ç–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
1. –í–∫–ª—é—á–∏—Ç–µ debug —Ä–µ–∂–∏–º
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ ID —Å—á–µ—Ç—á–∏–∫–æ–≤
3. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑ debug –ø–∞–Ω–µ–ª—å

### –î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
1. –ù–µ –≤–∫–ª—é—á–∞–π—Ç–µ –≤–µ–±–≤–∏–∑–æ—Ä –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
2. –ò—Å–∫–ª—é—á–∏—Ç–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üîß –ú–∏–≥—Ä–∞—Ü–∏—è

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:
1. –ó–∞–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ä—ã–π AnalyticsProvider –Ω–∞ FlexibleAnalyticsProvider
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –Ω—É–∂–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ö—É–∫–æ–≤
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ debug —Ä–µ–∂–∏–º–µ
5. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
